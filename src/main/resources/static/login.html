<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Store - –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/components/auth.css">
</head>
<body class="auth-page">
    <!-- –•–µ–¥–µ—Ä -->
    <header class="header">
        <nav class="navbar container">
            <div class="logo">
                <span>üè™</span>
                E-Store
            </div>
            <a href="index.html" class="nav-links" style="color: white; text-decoration: none;">
                ‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é
            </a>
        </nav>
    </header>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <div class="auth-logo">üîê</div>
                <h1 class="auth-title">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h1>
                <p class="auth-subtitle">–í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º –º–∞–≥–∞–∑–∏–Ω–∞</p>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∏ -->
            <div class="tabs">
                <div class="tab active" id="loginTab">–í—Ö–æ–¥</div>
                <div class="tab" id="registerTab">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
            </div>
            
            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ -->
            <div class="success-message hidden" id="successMessage">
                ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏.
            </div>
            
            <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
            <div class="tab-content active" id="loginContent">
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label" for="loginUsername">
                            <span class="input-icon">üë§</span>
                            –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        </label>
                        <input type="text" 
                               id="loginUsername" 
                               class="form-input" 
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
                               required
                               autocomplete="username">
                        <div class="error-message" id="loginUsernameError"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="loginPassword">
                            <span class="input-icon">üîí</span>
                            –ü–∞—Ä–æ–ª—å
                        </label>
                        <input type="password" 
                               id="loginPassword" 
                               class="form-input" 
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
                               required
                               autocomplete="current-password">
                        <div class="error-message" id="loginPasswordError"></div>
                    </div>
                    
                    <div class="remember-me">
                        <input type="checkbox" id="rememberMe">
                        <label for="rememberMe">–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è</label>
                    </div>
                    
                    <button type="submit" class="btn btn-primary auth-button" id="loginButton">
                        <span class="spinner hidden"></span>
                        <span id="loginButtonText">–í–æ–π—Ç–∏</span>
                    </button>
                    
                    <div class="test-credentials">
                        <h4>–¢–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã:</h4>
                        <p><strong>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:</strong> admin / admin123</p>
                        <p><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> user / user123</p>
                    </div>
                </form>
            </div>
            
            <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
            <div class="tab-content" id="registerContent">
                <form id="registerForm">
                    <div class="form-group">
                        <label class="form-label" for="registerUsername">
                            <span class="input-icon">üë§</span>
                            –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        </label>
                        <input type="text" 
                               id="registerUsername" 
                               class="form-input" 
                               placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
                               required
                               minlength="3"
                               maxlength="50"
                               autocomplete="username">
                        <div class="error-message" id="registerUsernameError"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="registerEmail">
                            <span class="input-icon">üìß</span>
                            Email –∞–¥—Ä–µ—Å
                        </label>
                        <input type="email" 
                               id="registerEmail" 
                               class="form-input" 
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email"
                               required
                               autocomplete="email">
                        <div class="error-message" id="registerEmailError"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="registerPassword">
                            <span class="input-icon">üîí</span>
                            –ü–∞—Ä–æ–ª—å
                        </label>
                        <input type="password" 
                               id="registerPassword" 
                               class="form-input" 
                               placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤)"
                               required
                               minlength="6"
                               autocomplete="new-password">
                        <div class="error-message" id="registerPasswordError"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="registerPasswordConfirm">
                            <span class="input-icon">üîí</span>
                            –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
                        </label>
                        <input type="password" 
                               id="registerPasswordConfirm" 
                               class="form-input" 
                               placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
                               required
                               autocomplete="new-password">
                        <div class="error-message" id="registerPasswordConfirmError"></div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary auth-button" id="registerButton">
                        <span class="spinner hidden"></span>
                        <span id="registerButtonText">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</span>
                    </button>
                    
                    <div class="form-footer">
                        <p>–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—è—Å—å, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å <a href="#" class="auth-link">–ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a></p>
                    </div>
                </form>
            </div>
            
            <div class="auth-links">
                <a href="index.html" class="auth-link">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
                <a href="#" class="auth-link">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
            </div>
        </div>
    </main>

    <!-- –§—É—Ç–µ—Ä -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>E-Store</h3>
                    <p>–í–∞—à –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä—Ç–Ω–µ—Ä –≤ –º–∏—Ä–µ —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∏ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π</p>
                </div>
                <div class="footer-section">
                    <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                    <p>üìû +375 (29) 123-45-67</p>
                    <p>‚úâÔ∏è info@estore.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 E-Store. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="js/components/auth.service.js"></script>
    <script src="js/utils/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Login page loaded');
            
            const loginTab = document.getElementById('loginTab');
            const registerTab = document.getElementById('registerTab');
            const loginContent = document.getElementById('loginContent');
            const registerContent = document.getElementById('registerContent');
            const successMessage = document.getElementById('successMessage');
            
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            
            const loginButton = document.getElementById('loginButton');
            const loginButtonText = document.getElementById('loginButtonText');
            const loginSpinner = loginButton.querySelector('.spinner');
            
            const registerButton = document.getElementById('registerButton');
            const registerButtonText = document.getElementById('registerButtonText');
            const registerSpinner = registerButton.querySelector('.spinner');
            
            loginTab.addEventListener('click', () => switchTab('login'));
            registerTab.addEventListener('click', () => switchTab('register'));
            
            function switchTab(tab) {
                loginTab.classList.toggle('active', tab === 'login');
                registerTab.classList.toggle('active', tab === 'register');
                
                loginContent.classList.toggle('active', tab === 'login');
                registerContent.classList.toggle('active', tab === 'register');
                
                successMessage.classList.add('hidden');
            }
            
            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const username = document.getElementById('loginUsername').value.trim();
                const password = document.getElementById('loginPassword').value;
                
                let isValid = true;
                
                if (!username) {
                    showError('loginUsernameError', '–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                    isValid = false;
                } else {
                    hideError('loginUsernameError');
                }
                
                if (!password) {
                    showError('loginPasswordError', '–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å');
                    isValid = false;
                } else {
                    hideError('loginPasswordError');
                }
                
                if (!isValid) return;
                
                loginButton.disabled = true;
                loginButtonText.textContent = '–í—Ö–æ–¥...';
                loginSpinner.classList.remove('hidden');
                
                try {
                    if (typeof AuthService !== 'undefined' && AuthService.login) {
                        const response = await AuthService.login(username, password);
                        showNotification('–í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω!', 'success');
                        
                        setTimeout(() => {
                            window.location.href = 'index.html';
                        }, 1000);
                        
                    } else {
                        showNotification('–í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω! (–¥–µ–º–æ-—Ä–µ–∂–∏–º)', 'success');
                        
                        localStorage.setItem('token', 'demo-token-' + Date.now());
                        localStorage.setItem('user', JSON.stringify({
                            id: 1,
                            username: username,
                            role: username === 'admin' ? 'ROLE_ADMIN' : 'ROLE_USER'
                        }));
                        
                        setTimeout(() => {
                            window.location.href = 'index.html';
                        }, 1000);
                    }
                    
                } catch (error) {
                    showError('loginPasswordError', '–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
                    showNotification('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message, 'error');
                    loginForm.classList.add('shake');
                    setTimeout(() => loginForm.classList.remove('shake'), 500);
                    
                } finally {
                    loginButton.disabled = false;
                    loginButtonText.textContent = '–í–æ–π—Ç–∏';
                    loginSpinner.classList.add('hidden');
                }
            });
            
            registerForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const username = document.getElementById('registerUsername').value.trim();
                const email = document.getElementById('registerEmail').value.trim();
                const password = document.getElementById('registerPassword').value;
                const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
                
                let isValid = true;
                
                if (!username) {
                    showError('registerUsernameError', '–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                    isValid = false;
                } else if (username.length < 3) {
                    showError('registerUsernameError', '–ú–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞');
                    isValid = false;
                } else {
                    hideError('registerUsernameError');
                }
                
                if (!email) {
                    showError('registerEmailError', '–í–≤–µ–¥–∏—Ç–µ email');
                    isValid = false;
                } else if (!isValidEmail(email)) {
                    showError('registerEmailError', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email');
                    isValid = false;
                } else {
                    hideError('registerEmailError');
                }
                
                if (!password) {
                    showError('registerPasswordError', '–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å');
                    isValid = false;
                } else if (password.length < 6) {
                    showError('registerPasswordError', '–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤');
                    isValid = false;
                } else {
                    hideError('registerPasswordError');
                }
                
                if (!passwordConfirm) {
                    showError('registerPasswordConfirmError', '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å');
                    isValid = false;
                } else if (password !== passwordConfirm) {
                    showError('registerPasswordConfirmError', '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                    isValid = false;
                } else {
                    hideError('registerPasswordConfirmError');
                }
                
                if (!isValid) return;
                
                registerButton.disabled = true;
                registerButtonText.textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...';
                registerSpinner.classList.remove('hidden');
                
                try {
                    if (typeof AuthService !== 'undefined' && AuthService.register) {
                        await AuthService.register({
                            username: username,
                            email: email,
                            password: password
                        });
                        
                        successMessage.classList.remove('hidden');
                        registerForm.reset();
                        
                        setTimeout(() => {
                            switchTab('login');
                        }, 2000);
                        
                    } else {
                        showNotification('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! (–¥–µ–º–æ-—Ä–µ–∂–∏–º)', 'success');
                        successMessage.classList.remove('hidden');
                        registerForm.reset();
                        
                        setTimeout(() => {
                            switchTab('login');
                        }, 2000);
                    }
                    
                } catch (error) {
                    showNotification('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + error.message, 'error');
                    
                } finally {
                    registerButton.disabled = false;
                    registerButtonText.textContent = '–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç';
                    registerSpinner.classList.add('hidden');
                }
            });
            
            function showError(elementId, message) {
                const element = document.getElementById(elementId);
                element.textContent = message;
                element.classList.add('show');
                
                const inputId = elementId.replace('Error', '');
                const input = document.getElementById(inputId);
                if (input) {
                    input.classList.add('error');
                    input.classList.remove('success');
                }
            }
            
            function hideError(elementId) {
                const element = document.getElementById(elementId);
                element.classList.remove('show');
                element.textContent = '';
                
                const inputId = elementId.replace('Error', '');
                const input = document.getElementById(inputId);
                if (input) {
                    input.classList.remove('error');
                    input.classList.add('success');
                }
            }
            
            function isValidEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            }
            
            function showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.innerHTML = `
                    <div class="notification-content">
                        ${message}
                    </div>
                `;
                
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === 'success' ? '#27ae60' : type === 'error' ? '#e74c3c' : '#3498db'};
                    color: white;
                    padding: 15px 20px;
                    border-radius: 5px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    z-index: 10000;
                    animation: slideIn 0.3s ease-out;
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease-in';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }
            
            document.getElementById('loginUsername').focus();
            
            if (window.location.hash === '#register') {
                switchTab('register');
            }
        });
    </script>

</body>
</html>