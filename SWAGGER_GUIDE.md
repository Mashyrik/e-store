# Руководство по использованию Swagger UI

## Что такое Swagger?

Swagger (OpenAPI) - это инструмент для документирования и тестирования REST API. Он автоматически генерирует интерактивную документацию на основе аннотаций в вашем коде.

## Как получить доступ к Swagger UI

1. **Запустите приложение** (Spring Boot должен быть запущен на порту 8080)

2. **Откройте браузер** и перейдите по адресу:
   ```
   http://localhost:8080/swagger-ui.html
   ```
   или
   ```
   http://localhost:8080/swagger-ui/index.html
   ```

3. Вы увидите интерактивный интерфейс со всеми доступными API эндпоинтами.

## Структура Swagger UI

### Основные разделы:

1. **Аутентификация** - API для регистрации и входа
2. **Товары** - Управление товарами
3. **Категории** - Управление категориями
4. **Заказы** - Управление заказами
5. **Корзина** - Управление корзиной покупок
6. **Пользователи** - Управление профилем
7. **Администрирование** - Админские функции

## Как использовать Swagger UI

### 1. Просмотр эндпоинтов

- Каждый контроллер отображается как отдельная секция
- Раскройте секцию, чтобы увидеть все методы
- Нажмите на метод, чтобы увидеть детали

### 2. Авторизация (JWT токен)

Для доступа к защищенным эндпоинтам нужно авторизоваться:

1. **Получите JWT токен:**
   - Перейдите в секцию **"Аутентификация"**
   - Найдите метод `POST /api/auth/login`
   - Нажмите "Try it out"
   - Введите данные:
     ```json
     {
       "username": "ваш_логин",
       "password": "ваш_пароль"
     }
     ```
   - Нажмите "Execute"
   - Скопируйте значение `token` из ответа

2. **Авторизуйтесь в Swagger:**
   - Нажмите кнопку **"Authorize"** (справа вверху)
   - В поле "Value" вставьте токен (без слова "Bearer", только сам токен)
   - Нажмите "Authorize"
   - Теперь все защищенные эндпоинты будут использовать этот токен

### 3. Тестирование эндпоинтов

1. **Выберите эндпоинт** из списка
2. **Нажмите "Try it out"**
3. **Заполните параметры** (если требуется):
   - Path parameters (например, `{id}`)
   - Query parameters
   - Request body (для POST/PUT запросов)
4. **Нажмите "Execute"**
5. **Просмотрите результат:**
   - Response body - тело ответа
   - Response code - код статуса (200, 404, и т.д.)
   - Response headers - заголовки ответа

### 4. Примеры использования

#### Пример 1: Получить все товары (публичный эндпоинт)
- Секция: **Товары**
- Метод: `GET /api/products`
- Нажмите "Try it out" → "Execute"
- Результат: список всех товаров

#### Пример 2: Создать товар (требует авторизации)
1. Сначала авторизуйтесь (см. раздел "Авторизация")
2. Секция: **Товары**
3. Метод: `POST /api/products`
4. Нажмите "Try it out"
5. Заполните Request body:
   ```json
   {
     "name": "Новый товар",
     "description": "Описание товара",
     "price": 999.99,
     "stock": 10,
     "categoryId": 1
   }
   ```
6. Нажмите "Execute"

#### Пример 3: Обновить статус заказа (только для админа)
1. Авторизуйтесь как администратор
2. Секция: **Заказы**
3. Метод: `PUT /api/orders/{id}/status`
4. Нажмите "Try it out"
5. Заполните:
   - `id`: номер заказа (например, 1)
   - `status`: новый статус (PENDING, PROCESSING, DELIVERED, CANCELLED)
6. Нажмите "Execute"

## Полезные функции

### Схема API (JSON)
- Доступна по адресу: `http://localhost:8080/v3/api-docs`
- Это JSON-представление всей API документации
- Можно использовать для генерации клиентского кода

### Фильтрация
- Используйте поиск вверху страницы для быстрого поиска эндпоинтов
- Эндпоинты отсортированы по методам и тегам

### Примеры запросов
- Swagger автоматически показывает примеры запросов и ответов
- Используйте их как шаблоны для своих запросов

## Настройки в application.properties

```properties
# Путь к документации API
springdoc.api-docs.path=/v3/api-docs

# Путь к Swagger UI
springdoc.swagger-ui.path=/swagger-ui.html

# Включить Swagger UI
springdoc.swagger-ui.enabled=true

# Сортировка операций по методу HTTP
springdoc.swagger-ui.operationsSorter=method

# Сортировка тегов по алфавиту
springdoc.swagger-ui.tagsSorter=alpha

# Включить кнопку "Try it out" по умолчанию
springdoc.swagger-ui.tryItOutEnabled=true
```

## Безопасность

- Swagger UI доступен без авторизации (настроено в `SecurityConfig`)
- Но для вызова защищенных эндпоинтов нужен JWT токен
- Токен автоматически добавляется в заголовок `Authorization: Bearer <token>`

## Решение проблем

### Swagger UI не открывается
- Убедитесь, что приложение запущено
- Проверьте, что порт 8080 свободен
- Проверьте настройки в `SecurityConfig.java` (должны быть разрешены `/swagger-ui/**` и `/v3/api-docs/**`)

### Ошибка 401 (Unauthorized)
- Убедитесь, что вы авторизовались через кнопку "Authorize"
- Проверьте, что токен не истек
- Получите новый токен через `/api/auth/login`

### Ошибка 403 (Forbidden)
- Убедитесь, что у вашего пользователя есть нужные права (например, ROLE_ADMIN для админских эндпоинтов)

## Дополнительная информация

- Документация SpringDoc OpenAPI: https://springdoc.org/
- OpenAPI спецификация: https://swagger.io/specification/

